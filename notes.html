<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Notes – Alice Chang</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <div class="site">
      <aside class="site-sidebar">
        <div class="site-sidebar-top">
          <div class="site-title-wrap">
            <div class="site-title">Alice Chang</div>
          </div>
          <p class="site-tagline">
            Musings on technology and creativity.
          </p>
          <nav class="site-nav">
            <a href="index.html" class="active">Notes</a>
            <div class="spine-list">
              <a href="notes.html?slug=thinking-with-machines" data-slug="thinking-with-machines">On Thinking With Machines</a>
              <a href="notes.html?slug=aesthetic-dna" data-slug="aesthetic-dna">Mapping Aesthetic DNA</a>
            </div>
            <a href="about.html">About</a>
          </nav>
        </div>
      </aside>

      <main class="site-main">
        <div class="section-label">Notes</div>
        
        <article id="essay-content" class="essay-body">
          <!-- Content will be loaded here -->
          <p>Loading...</p>
        </article>
      </main>

      <div class="site-sidebar-bottom">
        <div class="footer-copyright">Alice Chang &copy; 2025</div>
        <div class="footer-quote">The medium is the message.</div>
      </div>
    </div>

    <script>
      async function loadPost(slugArg) {
        // 1. Determine the slug to load
        let slug = slugArg;
        if (!slug) {
          const params = new URLSearchParams(window.location.search);
          slug = params.get('slug');
        }
        
        if (!slug) {
          window.location.href = 'index.html';
          return;
        }

        // 2. Fetch and render content
        try {
          const response = await fetch(`notes/${slug}.md`);
          if (!response.ok) throw new Error('Post not found');
          
          const text = await response.text();
          const contentDiv = document.getElementById('essay-content');
          
          contentDiv.innerHTML = marked.parse(text);
          
          // Update page title based on the first h1
          const h1 = contentDiv.querySelector('h1');
          if (h1) {
            document.title = `${h1.innerText} – Alice Chang`;
          }

          // 3. Update sidebar active state
          updateActiveSpine(slug);
          
        } catch (e) {
          console.error(e);
          document.getElementById('essay-content').innerHTML = `
            <div style="text-align: center; margin-top: 60px;">
               <div style="font-size: 2rem; margin-bottom: 16px;">Page Not Found</div>
               <p style="font-family: var(--font-serif); font-size: 1.2rem; font-style: italic;">The page you are looking for does not exist.</p>
               <a href="index.html" style="display: inline-block; margin-top: 24px; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.2em; text-decoration: none; border-bottom: 1px solid var(--border);">Return Home</a>
            </div>
          `;
        }
      }

      function updateActiveSpine(slug) {
        const spineLinks = document.querySelectorAll('.spine-list a');
        spineLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('data-slug') === slug) {
            link.classList.add('active');
          }
        });
      }

      // Initialize
      loadPost();

      // Setup SPA navigation for spine links
      document.addEventListener('DOMContentLoaded', () => {
        const spineLinks = document.querySelectorAll('.spine-list a');
        spineLinks.forEach(link => {
          link.addEventListener('click', (e) => {
            e.preventDefault();
            const slug = link.getAttribute('data-slug');
            const href = link.getAttribute('href');
            
            // Update URL without reload
            history.pushState({ slug }, '', href);
            
            // Load new content
            loadPost(slug);
            
            // Scroll to top of main content
            window.scrollTo(0, 0);
          });
        });
      });

      // Handle back/forward buttons
      window.addEventListener('popstate', (e) => {
        loadPost();
      });
    </script>
  </body>
</html>

